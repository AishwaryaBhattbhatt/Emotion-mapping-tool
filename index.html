<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emotion Mapping Tool</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"></script>
    <style>
        #map { height: 400px; }
        #form { margin-top: 20px; }
        .feeling-tag {
            display: inline-block;
            padding: 5px 10px;
            margin: 5px;
            border: 1px solid #ccc;
            border-radius: 20px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .feeling-tag.selected {
            background-color: #007bff;
            color: white;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="form">
        <div id="feeling-tags">
            <span class="feeling-tag" data-feeling="happy">Happy</span>
            <span class="feeling-tag" data-feeling="curious">Curious</span>
            <span class="feeling-tag" data-feeling="excited">Excited</span>
            <span class="feeling-tag" data-feeling="overwhelmed">Overwhelmed</span>
            <span class="feeling-tag" data-feeling="annoyed">Annoyed</span>
            <span class="feeling-tag" data-feeling="sad">Sad</span>
        </div>
        <textarea id="notes" placeholder="Enter your notes here"></textarea>
        <input type="file" id="photo" accept="image/*">
        <button onclick="saveLog()">Save Log</button>
    </div>

    <script>
        let map, marker, currentPosition;
        let emotionLogs = [];
        let selectedFeeling = null;

        function initMap() {
            map = L.map('map').setView([0, 0], 2);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© OpenStreetMap contributors'
            }).addTo(map);

            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    currentPosition = [position.coords.latitude, position.coords.longitude];
                    map.setView(currentPosition, 13);
                    marker = L.marker(currentPosition).addTo(map);
                }, function(error) {
                    console.error("Error: " + error.message);
                });
            } else {
                console.log("Geolocation is not supported by this browser.");
            }

            initFeelingTags();
        }

        function initFeelingTags() {
            const tags = document.querySelectorAll('.feeling-tag');
            tags.forEach(tag => {
                tag.addEventListener('click', function() {
                    tags.forEach(t => t.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedFeeling = this.dataset.feeling;
                });
            });
        }

        function saveLog() {
            if (!currentPosition) {
                alert("Unable to get your current location. Please try again.");
                return;
            }

            if (!selectedFeeling) {
                alert("Please select a feeling before saving.");
                return;
            }

            const notes = document.getElementById('notes').value;
            const photoInput = document.getElementById('photo');
            
            const reader = new FileReader();
            reader.onload = function(event) {
                const log = {
                    position: currentPosition,
                    feeling: selectedFeeling,
                    notes: notes,
                    photo: event.target.result
                };

                emotionLogs.push(log);
                addLogToMap(log);
                
                document.getElementById('notes').value = '';
                photoInput.value = '';
                document.querySelectorAll('.feeling-tag').forEach(tag => tag.classList.remove('selected'));
                selectedFeeling = null;
            };

            if (photoInput.files[0]) {
                reader.readAsDataURL(photoInput.files[0]);
            } else {
                reader.onload({target: {result: null}});
            }
        }

        function addLogToMap(log) {
            const popupContent = `
                <strong>Feeling:</strong> ${log.feeling}<br>
                <strong>Notes:</strong> ${log.notes}<br>
                ${log.photo ? `<img src="${log.photo}" alt="Uploaded photo" style="max-width: 100px; max-height: 100px;">` : ''}
            `;
            L.marker(log.position).addTo(map).bindPopup(popupContent);
        }

        window.onload = initMap;
    </script>
</body>
</html>